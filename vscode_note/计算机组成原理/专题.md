# <center>  cache计算 <center/>

## 1. cache存储计算

> 假设某个计算机的主存地址空间是256MB，按照字节编址，其数据Cache有8行，行长有64B。
> 1. 不考虑用于Cache的一致性维护位和替换算法控制位，并且采用直接映射方式，则该数Cache的总容量是多少？
> 2. 若该Cache采用直接映射方式，则主存地址为3200（十进制）的主存对应的Cache行号是多少？若采用二路组相连映射又是多少？

1. [解析]：本问要求计算cache总容量。涉及cache容量的计算首先明确一点：**不论采用何种映射策略，cache总容量 = 存储容量 + 标记容量（Tag）**。

    存储容量通常已经给出。**标记容量**取决于不同的映射策略。对于这里的直接映射而言，可以借助主存地址结构`[标记][cache行号][块内地址]`，用**主存容量除以cache容量，得到的结果取2的次幂就是标记位数**。因此，标记占19位。       

    抑或可以这样理解。主存容量除以cache容量，得到的数字可以解读为**主存等于多少个cache**，
2. [解析]：给出cache地址，问cache行号。和第一问类似，**首先先定位主存块号**，即该主存地址落在第几个主存块内。**然后再看该主存块落在第几个cache块**，这里就涉及到映射策略的选择。

    由于按字节编址，主存按块划分，一块大小64B，所以地址3200对应的主存块编号为3200 / 64 = 50。

    对于直接映射方式，直接用主存块号 mod cache行号，得2。

    对于2路组相连映射方式，就是把cache行两两合并在一组，也就是用主存块号 mod cache组数，得2，即行号是4或5。

> 某存储系统中，主存容量是Cache容量的4096倍，Cache被分为64个块。当主存地址采用直接映射时，地址映射表的大小应该是？（不考虑一致性和替换位）。

> 有一主存-Cache层次的存储器，按字节编址，其主存容量为1MB,Cache容量为16KB.每字块有8个字，每字32位。采用直接映射存储，若主存地址是35301H，且CPU访问Cache命中，则在Cache的第152字块中。（Cache字块起始是第0字块）

## 2. cache缺失率计算

> 有如下c语言程序段
> ```cpp
> for(int k = 0; k < 1000; k++) {
>   a[k] = a[k]+32;
> }
> ```
> 若数组a以及变量k均为int型，int型数据占4B，数据Cache采用直接映射 方式，数据区大小是1KB，块大小是16B，该程序段执行前Cache为空，则该程序段执行过程中，访问数组a的Cache的缺失率是？

1. [解析]：int占4B，那么1000个int占4000B，也就是需要占用4000 / 16 = 250 块主存块。cache可划分为1024 / 16 = 64 块。所以问题简化为**将250块主存块映射到64块cache**。

    本题容易这样理解：主存和cache以块为单位交换，也就是一次交换4个int数据。第一个数据不命中，调入后三个都命中，所以命中率为25%。这样的理解是错的。

    因为有赋值语句，所以访问数据后还要写回数据。也就是对一个数据进行读写两次操作。第一个数据读不命中，写命中，后面三个数据读写都命中。**也就是对4个数据的8次操作，只有1次不命中**。因此缺失率为12.5%。